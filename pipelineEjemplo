pipeline {
    agent any
    environment {
        // Define las variables de entorno para usar en los pasos.
        BUILD_OUTPUT = 'build_output.txt'
        TEST_OUTPUT = 'test_output.txt'
        DEPLOY_OUTPUT = 'deploy_output.txt'
    }
    stages {
        stage('Preparation') {
            steps {
                // Limpiar o preparar el entorno de trabajo
                bat 'echo Preparing the environment > %BUILD_OUTPUT%'
                bat 'del %TEST_OUTPUT% %DEPLOY_OUTPUT%, 2>nul'
            }
        }
        stage('Build') {
            steps {
                // Simular un proceso de construcción
                bat 'echo Building the project >> %BUILD_OUTPUT%'
                bat 'echo Build successful >> %BUILD_OUTPUT%'
            }
        }
        stage('Test') {
            steps {
                // Simular la ejecución de pruebas
                bat 'echo Running tests > %TEST_OUTPUT%'
                bat 'echo Tests passed >> %TEST_OUTPUT%'
            }
        }
        stage('Deploy') {
            steps {
                // Simular un proceso de despliegue
                bat 'echo Deploying to server > %DEPLOY_OUTPUT%'
                bat 'echo Deploy successful >> %DEPLOY_OUTPUT%'
            }
        }
        stage('Cleanup') {
            steps {
                // Limpiar los archivos temporales si es necesario
                script {
                    if (currentBuild.result == 'SUCCESS') {
                        bat 'echo Cleanup successful'
                    } else {
                        bat 'echo Skipping cleanup due to build failure'
                    }
                }
            }
        }
    }
    post {
        always {
            // Acciones para ejecutar después de completar los stages, independientemente del resultado
            echo 'Pipeline completed.'
        }
        success {
            // Acciones específicas si el pipeline fue exitoso
            echo 'Success! All stages completed successfully.'
        }
        failure {
            // Acciones específicas si el pipeline falló
            echo 'Failure encountered. Check the logs for details.'
        }
    }
}
